<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RestaurantPOS v3.0 - Sistema Profesional</title>
    
    <!-- Dependencias -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* ============================================================================
           RESET Y ESTILOS BASE
           ============================================================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        input, select, textarea {
            font-size: 16px !important;
        }

        /* ============================================================================
           ESTILOS DE IMPRESI√ìN T√âRMICA
           ============================================================================ */
        @media print {
            @page {
                size: 80mm auto;
                margin: 0;
            }
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .thermal-receipt {
                width: 80mm !important;
                font-family: 'Courier New', monospace !important;
                font-size: 12px !important;
                padding: 5mm !important;
                margin: 0 auto !important;
                box-shadow: none !important;
            }
        }

        .thermal-receipt {
            width: 80mm;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 20px;
            margin: 0 auto;
            background: white;
        }

        /* ============================================================================
           SCROLL PERSONALIZADO
           ============================================================================ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* ============================================================================
           GRID DE EMOJIS
           ============================================================================ */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 6px;
        }

        @media (min-width: 640px) {
            .emoji-grid {
                grid-template-columns: repeat(8, 1fr);
                gap: 8px;
            }
        }

        .emoji-button {
            font-size: 1.25rem;
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
            min-height: 40px;
        }

        @media (min-width: 640px) {
            .emoji-button {
                font-size: 1.5rem;
            }
        }

        .emoji-button:hover {
            transform: scale(1.1);
            background-color: #f3f4f6;
        }

        .emoji-button.selected {
            background-color: #fed7aa;
            border: 2px solid #f97316;
            transform: scale(1.1);
        }

        /* ============================================================================
           ANIMACIONES
           ============================================================================ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .time-update {
            animation: fadeIn 0.3s ease-out;
        }

        /* ============================================================================
           GRID DE PRODUCTOS
           ============================================================================ */
        .product-grid {
            display: grid;
            gap: 0.75rem;
            grid-template-columns: repeat(2, 1fr);
        }

        @media (min-width: 640px) {
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
            }
        }

        @media (min-width: 1024px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* ============================================================================
           MODALES
           ============================================================================ */
        .modal-overlay {
            animation: fadeIn 0.2s ease-out;
        }

        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }

        @media (max-width: 640px) {
            .modal-content {
                max-height: 85vh;
                margin: 0.5rem;
            }
        }

        /* ============================================================================
           BOTONES T√ÅCTILES
           ============================================================================ */
        .btn-touch {
            padding: 0.75rem 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .btn-touch:active {
            transform: scale(0.98);
        }

        @media (max-width: 640px) {
            .btn-touch {
                padding: 0.875rem 1rem;
            }
        }

        .touch-target {
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* ============================================================================
           TARJETAS DE PRODUCTO
           ============================================================================ */
        .product-card {
            transition: all 0.2s;
        }

        .product-card:hover {
            transform: translateY(-2px);
        }

        /* ============================================================================
           BADGES
           ============================================================================ */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* ============================================================================
           LOGO
           ============================================================================ */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-image {
            max-height: 60px;
            max-width: 120px;
            object-fit: contain;
        }

        .logo-emoji {
            font-size: 2.5rem;
            line-height: 1;
        }

        /* ============================================================================
           HORA
           ============================================================================ */
        .big-time {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* ============================================================================
           NAVEGACI√ìN MEJORADA - VISIBILIDAD ASEGURADA
           ============================================================================ */
        .nav-container {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-top: 0;
            padding: 0.5rem 1rem;
        }

        .nav-button {
            background-color: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
            font-weight: 500;
        }

        .nav-button:hover {
            background-color: #e5e7eb;
            color: #111827;
        }

        .nav-button-active {
            background: linear-gradient(to right, #f97316, #ef4444);
            color: white;
            border: none;
        }

        .nav-button-active:hover {
            background: linear-gradient(to right, #ea580c, #dc2626);
            color: white;
        }

        /* ============================================================================
           BOT√ìN DE SALIR - VISIBILIDAD GARANTIZADA
           ============================================================================ */
        .logout-button {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid white;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(4px);
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.35);
            border: 1px solid white;
            color: white;
        }

        .logout-button span, 
        .logout-button svg {
            color: white !important;
            stroke: white !important;
        }

        /* ============================================================================
           CONTENEDOR PRINCIPAL
           ============================================================================ */
        .main-container {
            background-color: #f9fafb;
            min-height: calc(100vh - 120px);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // ============================================================================
        // CONSTANTES Y CONFIGURACI√ìN
        // ============================================================================
        const CONFIG = {
            APP_NAME: 'RestaurantPOS',
            APP_VERSION: '3.0',
            DEFAULT_USER: { 
                id: 1, 
                username: 'admin', 
                password: 'admin', 
                role: 'admin', 
                name: 'Administrador' 
            },
            DEFAULT_CASHIER: { 
                id: 2, 
                username: 'cajero', 
                password: 'cajero', 
                role: 'cashier', 
                name: 'Cajero Principal' 
            },
            DEFAULT_CATEGORIES: ['Comida', 'Bebida', 'Postre', 'Entrada'],
            DEFAULT_BUSINESS: { 
                name: 'Mi Restaurante', 
                logo: 'üçΩÔ∏è', 
                logoType: 'emoji' 
            },
            STORAGE_KEYS: {
                PRODUCTS: 'restaurantProducts',
                SALES: 'restaurantSales',
                CATEGORIES: 'restaurantCategories',
                USERS: 'restaurantUsers',
                BUSINESS_NAME: 'businessName',
                BUSINESS_LOGO: 'businessLogo',
                LOGO_TYPE: 'logoType'
            }
        };

        const EMOJIS = [
            'üçΩÔ∏è', 'üçï', 'üçî', 'üçó', 'üåÆ', 'üçú', 'üç±', 'üçõ',
            'üçù', 'ü•ò', 'üç≥', 'ü•ó', 'üåØ', 'ü•ô', 'üçñ', 'ü•©',
            'üç§', 'ü¶û', 'üç£', 'üç±', 'üç≤', 'ü•ü', 'üç¢', 'üç°',
            'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø',
            'üç©', 'üç™', '‚òï', 'üçµ', 'ü•§', 'üçπ', 'üç∏', 'üç∫',
            'üçª', 'ü•Ç', 'üç∑', 'ü•É', 'üçæ', 'üßÉ', 'üßã', 'ü•õ',
            'üè™', 'üè¨', 'üè¢', 'üç¥', 'ü•Ñ', 'üî™', 'ü•¢', 'üç∂',
            'üéä', 'üéâ', '‚≠ê', 'üíé', 'üë®‚Äçüç≥', 'üë©‚Äçüç≥', 'üßë‚Äçüç≥', 'üéØ'
        ];

        // ============================================================================
        // FORMATEADORES
        // ============================================================================
        const Formatters = {
            time: (date) => {
                return date.toLocaleTimeString('es-ES', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
            },
            date: (date) => {
                return date.toLocaleDateString('es-ES', { 
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            },
            shortDate: (date) => {
                return date.toLocaleDateString('es-ES');
            },
            currency: (amount) => {
                return `$${parseFloat(amount).toFixed(2)}`;
            },
            datetime: (date) => {
                return date.toLocaleString('es-ES');
            }
        };

        // ============================================================================
        // HOOKS PERSONALIZADOS
        // ============================================================================
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = React.useState(() => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error('Error reading localStorage:', error);
                    return initialValue;
                }
            });

            React.useEffect(() => {
                try {
                    localStorage.setItem(key, JSON.stringify(storedValue));
                } catch (error) {
                    console.error('Error writing to localStorage:', error);
                }
            }, [key, storedValue]);

            return [storedValue, setStoredValue];
        };

        const useCurrentTime = () => {
            const [currentTime, setCurrentTime] = React.useState(new Date());

            React.useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            return currentTime;
        };

        const useProductFilter = (products, category, searchTerm) => {
            return React.useMemo(() => {
                return products.filter(product => {
                    const matchesCategory = category === 'Todas' || product.category === category;
                    const matchesSearch = product.name.toLowerCase().includes(searchTerm.toLowerCase());
                    return matchesCategory && matchesSearch;
                });
            }, [products, category, searchTerm]);
        };

        // ============================================================================
        // ICONOS
        // ============================================================================
        const Icons = {
            ShoppingCart: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
            ),
            TrendingUp: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                    <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
            ),
            Package: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M16.5 9.4 7.55 4.24"></path>
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
            ),
            Settings: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            ),
            LogOut: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
            ),
            Trash: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            ),
            Plus: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            ),
            Minus: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            ),
            Edit: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
            ),
            X: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            ),
            Printer: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
            ),
            DollarSign: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
            ),
            Users: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            ),
            Tag: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                </svg>
            ),
            Check: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            ),
            Upload: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            ),
            Download: ({ size = 24, className = "" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            )
        };

        // ============================================================================
        // CONTEXTO GLOBAL
        // ============================================================================
        const AppContext = React.createContext();

        // ============================================================================
        // COMPONENTES UI REUTILIZABLES
        // ============================================================================
        const Button = ({ 
            children, 
            variant = 'primary', 
            size = 'md', 
            icon, 
            onClick, 
            disabled, 
            className = '', 
            type = 'button', 
            fullWidth = false 
        }) => {
            const variants = {
                primary: 'bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600',
                secondary: 'bg-gray-200 text-gray-700 hover:bg-gray-300',
                success: 'bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700',
                danger: 'bg-red-500 text-white hover:bg-red-600',
                warning: 'bg-yellow-500 text-white hover:bg-yellow-600',
                info: 'bg-blue-500 text-white hover:bg-blue-600',
                outline: 'border-2 border-orange-500 text-orange-600 hover:bg-orange-50'
            };

            const sizes = {
                sm: 'px-3 py-2 text-sm',
                md: 'px-4 py-3 text-base',
                lg: 'px-6 py-4 text-lg'
            };

            return (
                <button
                    type={type}
                    onClick={onClick}
                    disabled={disabled}
                    className={`
                        btn-touch font-semibold rounded-lg transition-all shadow-sm
                        ${variants[variant]} ${sizes[size]} 
                        ${fullWidth ? 'w-full' : ''}
                        ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
                        ${className}
                    `}
                >
                    <div className="flex items-center justify-center gap-2">
                        {icon && icon}
                        {children}
                    </div>
                </button>
            );
        };

        const Card = ({ children, className = '', padding = true }) => {
            return (
                <div className={`bg-white rounded-xl shadow-md ${padding ? 'p-4 sm:p-6' : ''} ${className}`}>
                    {children}
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
            if (!isOpen) return null;

            const sizes = {
                sm: 'max-w-md',
                md: 'max-w-lg',
                lg: 'max-w-2xl',
                xl: 'max-w-4xl'
            };

            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-overlay">
                    <div className={`bg-white rounded-xl shadow-2xl w-full ${sizes[size]} modal-content`}>
                        <div className="p-4 sm:p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl sm:text-2xl font-bold">{title}</h3>
                                <button
                                    onClick={onClose}
                                    className="touch-target p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <Icons.X size={24} />
                                </button>
                            </div>
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const Input = ({ 
            label, 
            type = 'text', 
            value, 
            onChange, 
            required = false, 
            placeholder = '', 
            className = '', 
            step, 
            accept, 
            autoFocus,
            children 
        }) => {
            return (
                <div className="mb-4">
                    {label && (
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                            {label} {required && <span className="text-red-500">*</span>}
                        </label>
                    )}
                    {type === 'select' ? (
                        <select
                            value={value}
                            onChange={onChange}
                            className={`w-full px-4 py-2 sm:py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent ${className}`}
                            required={required}
                        >
                            {placeholder && <option value="">{placeholder}</option>}
                            {children}
                        </select>
                    ) : type === 'textarea' ? (
                        <textarea
                            value={value}
                            onChange={onChange}
                            placeholder={placeholder}
                            className={`w-full px-4 py-2 sm:py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent ${className}`}
                            required={required}
                        />
                    ) : (
                        <input
                            type={type}
                            value={value}
                            onChange={onChange}
                            placeholder={placeholder}
                            step={step}
                            accept={accept}
                            autoFocus={autoFocus}
                            className={`w-full px-4 py-2 sm:py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent ${className}`}
                            required={required}
                        />
                    )}
                </div>
            );
        };

        const Badge = ({ children, variant = 'default', className = '' }) => {
            const variants = {
                default: 'bg-gray-100 text-gray-600',
                success: 'bg-green-100 text-green-600',
                warning: 'bg-yellow-100 text-yellow-600',
                danger: 'bg-red-100 text-red-600',
                info: 'bg-blue-100 text-blue-600',
                orange: 'bg-orange-100 text-orange-600',
                purple: 'bg-purple-100 text-purple-600'
            };

            return (
                <span className={`badge ${variants[variant]} ${className}`}>
                    {children}
                </span>
            );
        };

        // ============================================================================
        // COMPONENTES DE NEGOCIO
        // ============================================================================
        const LogoDisplay = () => {
            const { businessLogo, logoType } = React.useContext(AppContext);
            
            return logoType === 'image' ? (
                <img src={businessLogo} alt="Logo" className="logo-image max-h-12 sm:max-h-16" />
            ) : (
                <span className="text-3xl sm:text-4xl">{businessLogo}</span>
            );
        };

        const Login = ({ onLogin }) => {
            const [username, setUsername] = React.useState('');
            const [password, setPassword] = React.useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                onLogin(username, password);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-400 via-red-400 to-pink-500 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-md fade-in">
                        <div className="text-center mb-6 sm:mb-8">
                            <div className="text-5xl sm:text-6xl mb-3 sm:mb-4">üçΩÔ∏è</div>
                            <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">{CONFIG.APP_NAME}</h1>
                            <p className="text-sm sm:text-base text-gray-600">Sistema Profesional v{CONFIG.APP_VERSION}</p>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="space-y-4 sm:space-y-6">
                            <Input
                                label="Usuario"
                                type="text"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                placeholder="Ingrese usuario"
                                required
                            />
                            
                            <Input
                                label="Contrase√±a"
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Ingrese contrase√±a"
                                required
                            />
                            
                            <Button type="submit" variant="primary" fullWidth>
                                Iniciar Sesi√≥n
                            </Button>
                        </form>
                        
                        {/* CREDENCIALES OCULTAS - SOLO VISIBLES EN DESARROLLO */}
                        {/* 
                            Usuario administrador: admin / admin
                            Usuario cajero: cajero / cajero
                        */}
                    </div>
                </div>
            );
        };

        const Header = ({ user, onLogout }) => {
            const currentTime = useCurrentTime();

            return (
                <header className="bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg sticky top-0 z-50">
                    <div className="container mx-auto px-3 sm:px-6 py-3 sm:py-4">
                        <div className="flex items-center justify-between gap-2 sm:gap-4">
                            <div className="flex items-center gap-3">
                                <LogoDisplay />
                                <div>
                                    <h1 className="text-lg sm:text-2xl font-bold">{CONFIG.APP_NAME}</h1>
                                    <p className="text-xs sm:text-sm opacity-90 hidden sm:block">
                                        {user?.role === 'admin' ? 'Administrador' : 'Cajero'}: {user?.name}
                                    </p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2 sm:gap-4">
                                <div className="text-right hidden sm:block">
                                    <div className="big-time time-update text-xl sm:text-2xl font-bold">
                                        {Formatters.time(currentTime)}
                                    </div>
                                    <div className="text-xs opacity-90">
                                        {Formatters.date(currentTime)}
                                    </div>
                                </div>
                                
                                <button
                                    onClick={onLogout}
                                    className="logout-button flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 font-medium shadow-md"
                                >
                                    <Icons.LogOut size={20} />
                                    <span className="hidden sm:inline">Salir</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // ============================================================================
        // NAVEGACI√ìN MEJORADA - TOTALMENTE VISIBLE
        // ============================================================================
        const Navigation = ({ currentView, onViewChange }) => {
            const { currentUser } = React.useContext(AppContext);
            const isAdmin = currentUser?.role === 'admin';

            return (
                <div className="nav-container">
                    <div className="container mx-auto">
                        <div className="flex gap-2 sm:gap-3 overflow-x-auto py-2">
                            {/* Ventas - Siempre visible para todos */}
                            <button
                                onClick={() => onViewChange('sales')}
                                className={`
                                    btn-touch flex items-center gap-1 sm:gap-2 whitespace-nowrap px-4 py-2 rounded-lg
                                    transition-all duration-200 font-medium
                                    ${currentView === 'sales' 
                                        ? 'nav-button-active' 
                                        : 'nav-button'
                                    }
                                `}
                            >
                                <Icons.ShoppingCart size={18} />
                                <span className="text-sm sm:text-base">Ventas</span>
                            </button>

                            {/* Reportes - Siempre visible para todos */}
                            <button
                                onClick={() => onViewChange('reports')}
                                className={`
                                    btn-touch flex items-center gap-1 sm:gap-2 whitespace-nowrap px-4 py-2 rounded-lg
                                    transition-all duration-200 font-medium
                                    ${currentView === 'reports' 
                                        ? 'nav-button-active' 
                                        : 'nav-button'
                                    }
                                `}
                            >
                                <Icons.TrendingUp size={18} />
                                <span className="text-sm sm:text-base">Reportes</span>
                            </button>

                            {/* Inventario - Solo visible para admin */}
                            {isAdmin && (
                                <button
                                    onClick={() => onViewChange('inventory')}
                                    className={`
                                        btn-touch flex items-center gap-1 sm:gap-2 whitespace-nowrap px-4 py-2 rounded-lg
                                        transition-all duration-200 font-medium
                                        ${currentView === 'inventory' 
                                            ? 'nav-button-active' 
                                            : 'nav-button'
                                        }
                                    `}
                                >
                                    <Icons.Package size={18} />
                                    <span className="text-sm sm:text-base">Inventario</span>
                                </button>
                            )}

                            {/* Configuraci√≥n - Solo visible para admin */}
                            {isAdmin && (
                                <button
                                    onClick={() => onViewChange('settings')}
                                    className={`
                                        btn-touch flex items-center gap-1 sm:gap-2 whitespace-nowrap px-4 py-2 rounded-lg
                                        transition-all duration-200 font-medium
                                        ${currentView === 'settings' 
                                            ? 'nav-button-active' 
                                            : 'nav-button'
                                        }
                                    `}
                                >
                                    <Icons.Settings size={18} />
                                    <span className="text-sm sm:text-base">Configuraci√≥n</span>
                                </button>
                            )}
                        </div>

                        {/* Indicador de rol */}
                        <div className="pb-2 text-xs text-gray-600 border-t border-gray-200 pt-2">
                            <span className="font-semibold">Rol:</span> {isAdmin ? 'Administrador' : 'Cajero'} 
                            {!isAdmin && ' (Acceso: Ventas y Reportes)'}
                            {isAdmin && ' (Acceso completo)'}
                        </div>
                    </div>
                </div>
            );
        };

        const ProductCard = ({ product, onAddToCart }) => {
            const outOfStock = product.stock === 0;
            
            return (
                <div
                    onClick={() => !outOfStock && onAddToCart(product)}
                    className={`
                        product-card bg-white border-2 rounded-lg p-3 cursor-pointer 
                        transition-all hover:shadow-lg
                        ${outOfStock 
                            ? 'border-red-300 opacity-50 cursor-not-allowed' 
                            : 'border-gray-200 hover:border-orange-500'
                        }
                    `}
                >
                    {product.image && (
                        <img
                            src={product.image}
                            alt={product.name}
                            className="w-full h-24 sm:h-32 object-cover rounded-lg mb-2"
                        />
                    )}
                    <h3 className="font-semibold text-sm sm:text-base truncate">{product.name}</h3>
                    <p className="text-orange-600 font-bold text-base sm:text-lg">
                        {Formatters.currency(product.price)}
                    </p>
                    <Badge variant={outOfStock ? 'danger' : product.stock < 10 ? 'warning' : 'success'}>
                        Stock: {product.stock}
                    </Badge>
                </div>
            );
        };

        const CartItem = ({ item, onUpdateQuantity, onRemove }) => {
            return (
                <div className="flex items-center gap-2 p-2 bg-gray-50 rounded-lg">
                    <div className="flex-1 min-w-0">
                        <p className="font-semibold text-sm truncate">{item.name}</p>
                        <p className="text-xs sm:text-sm text-gray-600">
                            {Formatters.currency(item.price)} c/u
                        </p>
                    </div>
                    <div className="flex items-center gap-1 sm:gap-2">
                        <Button
                            variant="secondary"
                            size="sm"
                            icon={<Icons.Minus size={16} />}
                            onClick={() => onUpdateQuantity(item.id, -1)}
                            className="p-1 !px-2 !py-1"
                        />
                        <span className="w-8 text-center font-bold text-sm">{item.quantity}</span>
                        <Button
                            variant="secondary"
                            size="sm"
                            icon={<Icons.Plus size={16} />}
                            onClick={() => onUpdateQuantity(item.id, 1)}
                            className="p-1 !px-2 !py-1"
                        />
                        <Button
                            variant="danger"
                            size="sm"
                            icon={<Icons.Trash size={16} />}
                            onClick={() => onRemove(item.id)}
                            className="p-1 !px-2 !py-1 ml-1"
                        />
                    </div>
                </div>
            );
        };

        const CategoryFilter = ({ categories, selected, onSelect }) => {
            return (
                <div className="flex gap-2 mb-4 overflow-x-auto pb-2">
                    <button
                        onClick={() => onSelect('Todas')}
                        className={`
                            btn-touch whitespace-nowrap text-sm px-4 py-2 rounded-lg
                            ${selected === 'Todas'
                                ? 'bg-orange-500 text-white'
                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }
                        `}
                    >
                        Todas
                    </button>
                    {categories.map(cat => (
                        <button
                            key={cat}
                            onClick={() => onSelect(cat)}
                            className={`
                                btn-touch whitespace-nowrap text-sm px-4 py-2 rounded-lg
                                ${selected === cat
                                    ? 'bg-orange-500 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }
                            `}
                        >
                            {cat}
                        </button>
                    ))}
                </div>
            );
        };

        const PaymentModal = ({ isOpen, onClose, onConfirm }) => {
            const { getTotal, cart } = React.useContext(AppContext);
            const [paymentMethod, setPaymentMethod] = React.useState('cash');
            const [cashAmount, setCashAmount] = React.useState('');
            const [transferAmount, setTransferAmount] = React.useState('');
            const total = parseFloat(getTotal());

            const handleSubmit = (e) => {
                e.preventDefault();
                
                let isValid = false;
                let paymentData = {};

                if (paymentMethod === 'cash') {
                    const cash = parseFloat(cashAmount);
                    if (cash >= total) {
                        isValid = true;
                        paymentData = { cashAmount: cash, transferAmount: 0, change: (cash - total).toFixed(2) };
                    } else {
                        alert('El monto recibido es insuficiente');
                        return;
                    }
                } else if (paymentMethod === 'transfer') {
                    isValid = true;
                    paymentData = { cashAmount: 0, transferAmount: total, change: 0 };
                } else if (paymentMethod === 'mixed') {
                    const cash = parseFloat(cashAmount || 0);
                    const transfer = parseFloat(transferAmount || 0);
                    if (Math.abs((cash + transfer) - total) < 0.01) {
                        isValid = true;
                        paymentData = { cashAmount: cash, transferAmount: transfer, change: 0 };
                    } else {
                        alert('La suma de efectivo y transferencia debe ser igual al total');
                        return;
                    }
                }

                if (isValid) {
                    onConfirm({
                        paymentMethod,
                        ...paymentData,
                        total,
                        items: [...cart]
                    });
                    onClose();
                    setPaymentMethod('cash');
                    setCashAmount('');
                    setTransferAmount('');
                }
            };

            return (
                <Modal isOpen={isOpen} onClose={onClose} title="Procesar Pago">
                    <div className="mb-4 sm:mb-6 p-4 bg-orange-50 rounded-lg">
                        <div className="text-sm font-semibold text-orange-700 mb-2">Total a Pagar</div>
                        <div className="text-3xl sm:text-4xl font-bold text-orange-600">
                            {Formatters.currency(total)}
                        </div>
                    </div>

                    <form onSubmit={handleSubmit}>
                        <div className="mb-4 sm:mb-6">
                            <label className="block text-sm font-semibold text-gray-700 mb-3">M√©todo de Pago</label>
                            <div className="grid grid-cols-3 gap-2">
                                <Button
                                    type="button"
                                    variant={paymentMethod === 'cash' ? 'success' : 'secondary'}
                                    onClick={() => {
                                        setPaymentMethod('cash');
                                        setCashAmount('');
                                        setTransferAmount('');
                                    }}
                                    size="sm"
                                >
                                    üíµ Efectivo
                                </Button>
                                <Button
                                    type="button"
                                    variant={paymentMethod === 'transfer' ? 'success' : 'secondary'}
                                    onClick={() => {
                                        setPaymentMethod('transfer');
                                        setCashAmount('');
                                        setTransferAmount('');
                                    }}
                                    size="sm"
                                >
                                    üè¶ Transfer.
                                </Button>
                                <Button
                                    type="button"
                                    variant={paymentMethod === 'mixed' ? 'success' : 'secondary'}
                                    onClick={() => {
                                        setPaymentMethod('mixed');
                                        setCashAmount('');
                                        setTransferAmount('');
                                    }}
                                    size="sm"
                                >
                                    üí≥ Mixto
                                </Button>
                            </div>
                        </div>

                        {paymentMethod === 'cash' && (
                            <div className="mb-4 sm:mb-6">
                                <Input
                                    label="Monto Recibido"
                                    type="number"
                                    step="0.01"
                                    value={cashAmount}
                                    onChange={(e) => setCashAmount(e.target.value)}
                                    placeholder="0.00"
                                    required
                                    autoFocus
                                />
                                {cashAmount && parseFloat(cashAmount) >= total && (
                                    <div className="mt-3 p-3 bg-green-50 rounded-lg">
                                        <div className="text-sm text-green-700 font-semibold">Cambio a Devolver</div>
                                        <div className="text-2xl font-bold text-green-600">
                                            {Formatters.currency(parseFloat(cashAmount) - total)}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {paymentMethod === 'transfer' && (
                            <div className="mb-4 sm:mb-6 p-4 bg-blue-50 rounded-lg text-center">
                                <div className="text-blue-700 font-semibold mb-2">Monto a Transferir</div>
                                <div className="text-2xl sm:text-3xl font-bold text-blue-600">
                                    {Formatters.currency(total)}
                                </div>
                                <div className="text-sm text-blue-600 mt-2">
                                    Confirme que recibi√≥ la transferencia
                                </div>
                            </div>
                        )}

                        {paymentMethod === 'mixed' && (
                            <div className="mb-4 sm:mb-6 space-y-4">
                                <Input
                                    label="Efectivo"
                                    type="number"
                                    step="0.01"
                                    value={cashAmount}
                                    onChange={(e) => {
                                        setCashAmount(e.target.value);
                                        const remaining = total - parseFloat(e.target.value || 0);
                                        setTransferAmount(remaining > 0 ? remaining.toFixed(2) : '0.00');
                                    }}
                                    placeholder="0.00"
                                    required
                                    autoFocus
                                />
                                <Input
                                    label="Transferencia"
                                    type="number"
                                    step="0.01"
                                    value={transferAmount}
                                    onChange={(e) => {
                                        setTransferAmount(e.target.value);
                                        const remaining = total - parseFloat(e.target.value || 0);
                                        setCashAmount(remaining > 0 ? remaining.toFixed(2) : '0.00');
                                    }}
                                    placeholder="0.00"
                                    required
                                />
                                {cashAmount && transferAmount && (
                                    <div className="p-3 bg-purple-50 rounded-lg">
                                        <div className="flex justify-between text-sm mb-1">
                                            <span className="text-purple-700">Total Pagado:</span>
                                            <span className="font-bold text-purple-900">
                                                {Formatters.currency(parseFloat(cashAmount || 0) + parseFloat(transferAmount || 0))}
                                            </span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="flex gap-3">
                            <Button type="button" variant="secondary" onClick={onClose} fullWidth>
                                Cancelar
                            </Button>
                            <Button type="submit" variant="success" fullWidth>
                                Confirmar Pago
                            </Button>
                        </div>
                    </form>
                </Modal>
            );
        };

        const SalesModule = () => {
            const { 
                products, 
                categories, 
                cart, 
                setCart,
                addToCart,
                updateQuantity,
                removeFromCart,
                getTotal,
                setShowPaymentModal
            } = React.useContext(AppContext);

            const [searchTerm, setSearchTerm] = React.useState('');
            const [selectedCategory, setSelectedCategory] = React.useState('Todas');
            
            const filteredProducts = useProductFilter(products, selectedCategory, searchTerm);

            return (
                <div className="flex flex-col lg:flex-row gap-4 sm:gap-6">
                    <div className="flex-1">
                        <Card>
                            <div className="mb-4">
                                <Input
                                    type="text"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    placeholder="üîç Buscar producto..."
                                />
                            </div>

                            <CategoryFilter 
                                categories={categories}
                                selected={selectedCategory}
                                onSelect={setSelectedCategory}
                            />

                            <div className="product-grid max-h-[60vh] overflow-y-auto">
                                {filteredProducts.map(product => (
                                    <ProductCard 
                                        key={product.id} 
                                        product={product} 
                                        onAddToCart={addToCart}
                                    />
                                ))}
                            </div>

                            {filteredProducts.length === 0 && (
                                <div className="text-center py-12">
                                    <Icons.Package size={64} className="mx-auto text-gray-300 mb-4" />
                                    <p className="text-gray-500 text-lg">No hay productos</p>
                                </div>
                            )}
                        </Card>
                    </div>

                    <div className="lg:w-96 w-full">
                        <Card className="sticky top-20">
                            <h2 className="text-xl sm:text-2xl font-bold mb-4 flex items-center gap-2">
                                <Icons.ShoppingCart size={24} />
                                Carrito ({cart.length})
                            </h2>

                            <div className="space-y-2 mb-4 max-h-[40vh] overflow-y-auto">
                                {cart.map(item => (
                                    <CartItem 
                                        key={item.id}
                                        item={item}
                                        onUpdateQuantity={updateQuantity}
                                        onRemove={removeFromCart}
                                    />
                                ))}

                                {cart.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        Carrito vac√≠o
                                    </div>
                                )}
                            </div>

                            <div className="border-t-2 pt-4 space-y-2">
                                <div className="flex justify-between items-center">
                                    <span className="text-lg sm:text-xl font-bold">Total:</span>
                                    <span className="text-2xl sm:text-3xl font-bold text-orange-600">
                                        {Formatters.currency(getTotal())}
                                    </span>
                                </div>
                                
                                <Button
                                    variant="success"
                                    fullWidth
                                    disabled={cart.length === 0}
                                    onClick={() => setShowPaymentModal(true)}
                                >
                                    Procesar Pago
                                </Button>
                                
                                {cart.length > 0 && (
                                    <Button
                                        variant="secondary"
                                        fullWidth
                                        onClick={() => setCart([])}
                                    >
                                        Limpiar Carrito
                                    </Button>
                                )}
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const SummaryCards = ({ totalSales, totalCash, totalTransfer, count }) => {
            return (
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-6">
                    <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 sm:p-6 rounded-xl border-2 border-green-200">
                        <div className="flex items-center gap-2 mb-2">
                            <Icons.DollarSign className="text-green-600" size={20} />
                            <p className="text-xs sm:text-sm font-semibold text-green-700">Ventas Totales</p>
                        </div>
                        <p className="text-2xl sm:text-3xl font-bold text-green-600">{Formatters.currency(totalSales)}</p>
                        <p className="text-xs text-green-600 mt-1">{count} ventas</p>
                    </div>

                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 sm:p-6 rounded-xl border-2 border-blue-200">
                        <div className="flex items-center gap-2 mb-2">
                            <span className="text-lg sm:text-xl">üíµ</span>
                            <p className="text-xs sm:text-sm font-semibold text-blue-700">Efectivo</p>
                        </div>
                        <p className="text-2xl sm:text-3xl font-bold text-blue-600">{Formatters.currency(totalCash)}</p>
                    </div>

                    <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 sm:p-6 rounded-xl border-2 border-purple-200">
                        <div className="flex items-center gap-2 mb-2">
                            <span className="text-lg sm:text-xl">üè¶</span>
                            <p className="text-xs sm:text-sm font-semibold text-purple-700">Transferencias</p>
                        </div>
                        <p className="text-2xl sm:text-3xl font-bold text-purple-600">{Formatters.currency(totalTransfer)}</p>
                    </div>
                </div>
            );
        };

        const SalesTable = ({ sales }) => {
            return (
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Fecha/Hora</th>
                                <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Cajero</th>
                                <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase hidden sm:table-cell">Items</th>
                                <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Total</th>
                                <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase hidden md:table-cell">Pago</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-200">
                            {sales.slice().reverse().map(sale => (
                                <tr key={sale.id} className="hover:bg-gray-50">
                                    <td className="px-3 sm:px-6 py-4">
                                        <div className="text-xs sm:text-sm">
                                            <div className="font-semibold">{Formatters.shortDate(new Date(sale.date))}</div>
                                            <div className="text-gray-500">{sale.time}</div>
                                        </div>
                                    </td>
                                    <td className="px-3 sm:px-6 py-4">
                                        <div className="text-xs sm:text-sm text-gray-600">{sale.cashier || 'Cajero'}</div>
                                    </td>
                                    <td className="px-3 sm:px-6 py-4 hidden sm:table-cell">
                                        <div className="text-xs sm:text-sm text-gray-600">{sale.items.length} items</div>
                                    </td>
                                    <td className="px-3 sm:px-6 py-4 font-bold text-green-600 text-sm sm:text-base">
                                        {Formatters.currency(sale.total)}
                                    </td>
                                    <td className="px-3 sm:px-6 py-4 hidden md:table-cell">
                                        <Badge variant="default">
                                            {sale.paymentMethod === 'cash' ? 'üíµ Efectivo' :
                                             sale.paymentMethod === 'transfer' ? 'üè¶ Transfer.' :
                                             'üí≥ Mixto'}
                                        </Badge>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        };

        const ReportsModule = () => {
            const { sales } = React.useContext(AppContext);
            const [dateFilter, setDateFilter] = React.useState('today');
            const [selectedDate, setSelectedDate] = React.useState(new Date().toISOString().split('T')[0]);

            const getFilteredSales = React.useCallback(() => {
                return sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    const today = new Date();
                    
                    if (dateFilter === 'today') {
                        return saleDate.toDateString() === today.toDateString();
                    } else if (dateFilter === 'week') {
                        const weekAgo = new Date(today);
                        weekAgo.setDate(today.getDate() - 7);
                        return saleDate >= weekAgo;
                    } else if (dateFilter === 'month') {
                        return saleDate.getMonth() === today.getMonth() && 
                               saleDate.getFullYear() === today.getFullYear();
                    } else if (dateFilter === 'custom') {
                        const selected = new Date(selectedDate);
                        return saleDate.toDateString() === selected.toDateString();
                    }
                    return true;
                });
            }, [sales, dateFilter, selectedDate]);

            const filteredSales = getFilteredSales();
            
            const totals = React.useMemo(() => {
                return {
                    total: filteredSales.reduce((sum, sale) => sum + parseFloat(sale.total), 0),
                    cash: filteredSales.reduce((sum, sale) => sum + parseFloat(sale.cashAmount || 0), 0),
                    transfer: filteredSales.reduce((sum, sale) => sum + parseFloat(sale.transferAmount || 0), 0),
                    count: filteredSales.length
                };
            }, [filteredSales]);

            return (
                <div className="space-y-4 sm:space-y-6">
                    <Card>
                        <h2 className="text-xl sm:text-2xl font-bold mb-4 flex items-center gap-2">
                            <Icons.TrendingUp size={24} />
                            Reportes de Ventas
                        </h2>

                        <div className="flex flex-col sm:flex-row gap-2 sm:gap-4 mb-6">
                            <Button
                                variant={dateFilter === 'today' ? 'primary' : 'secondary'}
                                onClick={() => setDateFilter('today')}
                                size="sm"
                            >
                                Hoy
                            </Button>
                            <Button
                                variant={dateFilter === 'week' ? 'primary' : 'secondary'}
                                onClick={() => setDateFilter('week')}
                                size="sm"
                            >
                                Esta Semana
                            </Button>
                            <Button
                                variant={dateFilter === 'month' ? 'primary' : 'secondary'}
                                onClick={() => setDateFilter('month')}
                                size="sm"
                            >
                                Este Mes
                            </Button>
                            <Button
                                variant={dateFilter === 'all' ? 'primary' : 'secondary'}
                                onClick={() => setDateFilter('all')}
                                size="sm"
                            >
                                Todo
                            </Button>
                            <div className="flex-1">
                                <Input
                                    type="date"
                                    value={selectedDate}
                                    onChange={(e) => {
                                        setSelectedDate(e.target.value);
                                        setDateFilter('custom');
                                    }}
                                />
                            </div>
                        </div>

                        <SummaryCards 
                            totalSales={totals.total}
                            totalCash={totals.cash}
                            totalTransfer={totals.transfer}
                            count={totals.count}
                        />
                    </Card>

                    <Card>
                        <h3 className="text-lg sm:text-xl font-bold mb-4">Historial de Ventas</h3>
                        <SalesTable sales={filteredSales} />
                        
                        {filteredSales.length === 0 && (
                            <div className="text-center py-12">
                                <Icons.TrendingUp size={64} className="mx-auto text-gray-300 mb-4" />
                                <p className="text-gray-500 text-lg">No hay ventas para mostrar</p>
                            </div>
                        )}
                    </Card>
                </div>
            );
        };

        const InventoryModule = () => {
            const { products, setProducts, categories } = React.useContext(AppContext);
            const [showAddProduct, setShowAddProduct] = React.useState(false);
            const [editingProduct, setEditingProduct] = React.useState(null);
            const [newProduct, setNewProduct] = React.useState({
                name: '',
                price: '',
                category: 'Comida',
                stock: '',
                image: '',
                description: ''
            });

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setNewProduct({ ...newProduct, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingProduct) {
                    setProducts(products.map(p => 
                        p.id === editingProduct.id 
                            ? { ...newProduct, id: p.id, price: parseFloat(newProduct.price), stock: parseInt(newProduct.stock) }
                            : p
                    ));
                    setEditingProduct(null);
                } else {
                    const product = {
                        ...newProduct,
                        id: Date.now(),
                        price: parseFloat(newProduct.price),
                        stock: parseInt(newProduct.stock)
                    };
                    setProducts([...products, product]);
                }
                setNewProduct({
                    name: '',
                    price: '',
                    category: 'Comida',
                    stock: '',
                    image: '',
                    description: ''
                });
                setShowAddProduct(false);
            };

            const deleteProduct = (id) => {
                if (window.confirm('¬øEst√°s seguro de eliminar este producto?')) {
                    setProducts(products.filter(p => p.id !== id));
                }
            };

            const editProduct = (product) => {
                setEditingProduct(product);
                setNewProduct(product);
                setShowAddProduct(true);
            };

            return (
                <>
                    <Card>
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-6">
                            <h2 className="text-xl sm:text-2xl font-bold flex items-center gap-2">
                                <Icons.Package size={24} />
                                Inventario de Productos
                            </h2>
                            <Button
                                variant="primary"
                                icon={<Icons.Plus size={20} />}
                                onClick={() => setShowAddProduct(true)}
                                fullWidth={false}
                                className="w-full sm:w-auto"
                            >
                                Agregar Producto
                            </Button>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Producto</th>
                                        <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase hidden sm:table-cell">Categor√≠a</th>
                                        <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Precio</th>
                                        <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Stock</th>
                                        <th className="px-3 sm:px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {products.map(product => (
                                        <tr key={product.id} className="hover:bg-gray-50">
                                            <td className="px-3 sm:px-6 py-4">
                                                <div className="flex items-center gap-2 sm:gap-3">
                                                    {product.image && (
                                                        <img
                                                            src={product.image}
                                                            alt={product.name}
                                                            className="w-10 h-10 sm:w-12 sm:h-12 object-cover rounded"
                                                        />
                                                    )}
                                                    <div>
                                                        <div className="font-semibold text-sm sm:text-base">{product.name}</div>
                                                        <div className="text-xs text-gray-500 sm:hidden">{product.category}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-3 sm:px-6 py-4 hidden sm:table-cell">
                                                <Badge variant="orange">{product.category}</Badge>
                                            </td>
                                            <td className="px-3 sm:px-6 py-4 font-bold text-orange-600">
                                                {Formatters.currency(product.price)}
                                            </td>
                                            <td className="px-3 sm:px-6 py-4">
                                                <Badge variant={product.stock === 0 ? 'danger' : product.stock < 10 ? 'warning' : 'success'}>
                                                    {product.stock}
                                                </Badge>
                                            </td>
                                            <td className="px-3 sm:px-6 py-4">
                                                <div className="flex gap-1 sm:gap-2">
                                                    <Button
                                                        variant="outline"
                                                        size="sm"
                                                        icon={<Icons.Edit size={16} />}
                                                        onClick={() => editProduct(product)}
                                                        className="p-1.5 sm:p-2"
                                                    />
                                                    <Button
                                                        variant="danger"
                                                        size="sm"
                                                        icon={<Icons.Trash size={16} />}
                                                        onClick={() => deleteProduct(product.id)}
                                                        className="p-1.5 sm:p-2"
                                                    />
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {products.length === 0 && (
                            <div className="text-center py-12">
                                <Icons.Package size={64} className="mx-auto text-gray-300 mb-4" />
                                <p className="text-gray-500 text-lg">No hay productos en el inventario</p>
                                <p className="text-gray-400">Agrega tu primer producto para comenzar</p>
                            </div>
                        )}
                    </Card>

                    <Modal
                        isOpen={showAddProduct}
                        onClose={() => {
                            setShowAddProduct(false);
                            setEditingProduct(null);
                            setNewProduct({
                                name: '',
                                price: '',
                                category: 'Comida',
                                stock: '',
                                image: '',
                                description: ''
                            });
                        }}
                        title={editingProduct ? 'Editar Producto' : 'Agregar Producto'}
                    >
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <Input
                                label="Nombre"
                                type="text"
                                value={newProduct.name}
                                onChange={(e) => setNewProduct({ ...newProduct, name: e.target.value })}
                                required
                            />

                            <div className="grid grid-cols-2 gap-4">
                                <Input
                                    label="Precio"
                                    type="number"
                                    step="0.01"
                                    value={newProduct.price}
                                    onChange={(e) => setNewProduct({ ...newProduct, price: e.target.value })}
                                    required
                                />
                                <Input
                                    label="Stock"
                                    type="number"
                                    value={newProduct.stock}
                                    onChange={(e) => setNewProduct({ ...newProduct, stock: e.target.value })}
                                    required
                                />
                            </div>

                            <Input
                                label="Categor√≠a"
                                type="select"
                                value={newProduct.category}
                                onChange={(e) => setNewProduct({ ...newProduct, category: e.target.value })}
                                required
                            >
                                {categories.map(cat => (
                                    <option key={cat} value={cat}>{cat}</option>
                                ))}
                            </Input>

                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Imagen</label>
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageUpload}
                                    className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg"
                                />
                                {newProduct.image && (
                                    <img
                                        src={newProduct.image}
                                        alt="Preview"
                                        className="mt-2 w-full h-32 object-cover rounded-lg"
                                    />
                                )}
                            </div>

                            <div className="flex gap-3 pt-4">
                                <Button
                                    variant="secondary"
                                    onClick={() => {
                                        setShowAddProduct(false);
                                        setEditingProduct(null);
                                    }}
                                    fullWidth
                                >
                                    Cancelar
                                </Button>
                                <Button type="submit" variant="primary" fullWidth>
                                    {editingProduct ? 'Actualizar' : 'Agregar'}
                                </Button>
                            </div>
                        </form>
                    </Modal>
                </>
            );
        };

        const SettingsModule = () => {
            const { 
                businessName, setBusinessName,
                businessLogo, setBusinessLogo,
                logoType, setLogoType,
                categories, setCategories,
                users, setUsers,
                currentUser,
                exportData,
                importData
            } = React.useContext(AppContext);

            const [showEmojiPicker, setShowEmojiPicker] = React.useState(false);
            const [showUserManagement, setShowUserManagement] = React.useState(false);
            const [showCategoryManagement, setShowCategoryManagement] = React.useState(false);
            const [editingUser, setEditingUser] = React.useState(null);
            const [editingCategory, setEditingCategory] = React.useState(null);
            const [newUser, setNewUser] = React.useState({
                username: '',
                password: '',
                role: 'cashier',
                name: ''
            });
            const [newCategory, setNewCategory] = React.useState('');

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setBusinessLogo(reader.result);
                        setLogoType('image');
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addUser = (e) => {
                e.preventDefault();
                if (editingUser) {
                    setUsers(users.map(u => 
                        u.id === editingUser.id 
                            ? { ...newUser, id: u.id }
                            : u
                    ));
                    setEditingUser(null);
                } else {
                    const user = {
                        ...newUser,
                        id: Date.now()
                    };
                    setUsers([...users, user]);
                }
                setNewUser({ username: '', password: '', role: 'cashier', name: '' });
                setShowUserManagement(false);
            };

            const deleteUser = (id) => {
                if (id === currentUser?.id) {
                    alert('No puedes eliminar tu propio usuario');
                    return;
                }
                if (window.confirm('¬øEst√°s seguro de eliminar este usuario?')) {
                    setUsers(users.filter(u => u.id !== id));
                }
            };

            const editUser = (user) => {
                setEditingUser(user);
                setNewUser(user);
                setShowUserManagement(true);
            };

            const addCategory = (e) => {
                e.preventDefault();
                if (newCategory.trim()) {
                    if (editingCategory) {
                        const index = categories.indexOf(editingCategory);
                        if (index !== -1) {
                            const updatedCategories = [...categories];
                            updatedCategories[index] = newCategory;
                            setCategories(updatedCategories);
                        }
                        setEditingCategory(null);
                    } else {
                        if (!categories.includes(newCategory)) {
                            setCategories([...categories, newCategory]);
                        }
                    }
                    setNewCategory('');
                    setShowCategoryManagement(false);
                }
            };

            const deleteCategory = (category) => {
                if (window.confirm(`¬øEst√°s seguro de eliminar la categor√≠a "${category}"?`)) {
                    setCategories(categories.filter(c => c !== category));
                }
            };

            const editCategory = (category) => {
                setEditingCategory(category);
                setNewCategory(category);
                setShowCategoryManagement(true);
            };

            return (
                <div className="space-y-6">
                    <div className="max-w-2xl mx-auto">
                        <Card>
                            <h2 className="text-xl sm:text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icons.Settings size={24} />
                                Configuraci√≥n del Negocio
                            </h2>

                            <div className="space-y-6">
                                <Input
                                    label="Nombre del Negocio"
                                    type="text"
                                    value={businessName}
                                    onChange={(e) => setBusinessName(e.target.value)}
                                    placeholder="Mi Restaurante"
                                />

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Logo del Negocio</label>
                                    <div className="flex flex-col sm:flex-row gap-4">
                                        <div className="flex gap-2">
                                            <Button
                                                variant={logoType === 'emoji' ? 'primary' : 'secondary'}
                                                onClick={() => setLogoType('emoji')}
                                                size="sm"
                                            >
                                                Emoji
                                            </Button>
                                            <Button
                                                variant={logoType === 'image' ? 'primary' : 'secondary'}
                                                onClick={() => setLogoType('image')}
                                                size="sm"
                                            >
                                                Imagen
                                            </Button>
                                        </div>
                                    </div>

                                    {logoType === 'emoji' && (
                                        <div className="mt-4">
                                            <Button
                                                variant="secondary"
                                                icon={<span className="text-2xl">{businessLogo}</span>}
                                                onClick={() => setShowEmojiPicker(!showEmojiPicker)}
                                            >
                                                Cambiar Emoji
                                            </Button>

                                            {showEmojiPicker && (
                                                <div className="mt-4 p-4 bg-gray-50 rounded-lg max-h-64 overflow-y-auto">
                                                    <div className="emoji-grid">
                                                        {EMOJIS.map(emoji => (
                                                            <button
                                                                key={emoji}
                                                                onClick={() => {
                                                                    setBusinessLogo(emoji);
                                                                    setShowEmojiPicker(false);
                                                                }}
                                                                className={`emoji-button ${businessLogo === emoji ? 'selected' : ''}`}
                                                            >
                                                                {emoji}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {logoType === 'image' && (
                                        <div className="mt-4">
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={handleImageUpload}
                                                className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg"
                                            />
                                            {businessLogo && businessLogo.startsWith('data:') && (
                                                <img
                                                    src={businessLogo}
                                                    alt="Logo"
                                                    className="mt-4 max-h-32 rounded-lg border-2 border-gray-200"
                                                />
                                            )}
                                        </div>
                                    )}
                                </div>

                                <div className="pt-6 border-t-2">
                                    <h3 className="text-lg font-bold mb-4">Gesti√≥n de Datos</h3>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                        <Button
                                            variant="info"
                                            icon={<Icons.Download size={20} />}
                                            onClick={exportData}
                                        >
                                            Exportar Datos
                                        </Button>
                                        
                                        <label className="btn-touch bg-green-500 text-white hover:bg-green-600 transition-colors cursor-pointer flex items-center justify-center gap-2 rounded-lg">
                                            <Icons.Upload size={20} />
                                            Importar Datos
                                            <input
                                                type="file"
                                                accept=".json"
                                                onChange={importData}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </Card>
                    </div>

                    <div className="max-w-2xl mx-auto">
                        <Card>
                            <h3 className="text-xl sm:text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icons.Tag size={24} />
                                Gesti√≥n de Categor√≠as
                            </h3>

                            <div className="space-y-4">
                                <Button
                                    variant="primary"
                                    icon={<Icons.Plus size={20} />}
                                    onClick={() => {
                                        setEditingCategory(null);
                                        setNewCategory('');
                                        setShowCategoryManagement(true);
                                    }}
                                    fullWidth
                                >
                                    Agregar Categor√≠a
                                </Button>

                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                    {categories.map(category => (
                                        <div key={category} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <span className="font-semibold">{category}</span>
                                            <div className="flex gap-2">
                                                <Button
                                                    variant="outline"
                                                    size="sm"
                                                    icon={<Icons.Edit size={16} />}
                                                    onClick={() => editCategory(category)}
                                                    className="p-2"
                                                />
                                                {!CONFIG.DEFAULT_CATEGORIES.includes(category) && (
                                                    <Button
                                                        variant="danger"
                                                        size="sm"
                                                        icon={<Icons.Trash size={16} />}
                                                        onClick={() => deleteCategory(category)}
                                                        className="p-2"
                                                    />
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </Card>
                    </div>

                    <div className="max-w-2xl mx-auto">
                        <Card>
                            <h3 className="text-xl sm:text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icons.Users size={24} />
                                Gesti√≥n de Usuarios
                            </h3>

                            <div className="space-y-4">
                                <Button
                                    variant="primary"
                                    icon={<Icons.Plus size={20} />}
                                    onClick={() => {
                                        setEditingUser(null);
                                        setNewUser({ username: '', password: '', role: 'cashier', name: '' });
                                        setShowUserManagement(true);
                                    }}
                                    fullWidth
                                >
                                    Agregar Usuario
                                </Button>

                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Usuario</th>
                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Nombre</th>
                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Rol</th>
                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {users.map(user => (
                                                <tr key={user.id} className="hover:bg-gray-50">
                                                    <td className="px-4 py-4 font-medium">{user.username}</td>
                                                    <td className="px-4 py-4">{user.name}</td>
                                                    <td className="px-4 py-4">
                                                        <Badge variant={user.role === 'admin' ? 'purple' : 'success'}>
                                                            {user.role === 'admin' ? 'Administrador' : 'Cajero'}
                                                        </Badge>
                                                    </td>
                                                    <td className="px-4 py-4">
                                                        <div className="flex gap-2">
                                                            <Button
                                                                variant="outline"
                                                                size="sm"
                                                                icon={<Icons.Edit size={16} />}
                                                                onClick={() => editUser(user)}
                                                                className="p-2"
                                                            />
                                                            {user.id !== currentUser?.id && (
                                                                <Button
                                                                    variant="danger"
                                                                    size="sm"
                                                                    icon={<Icons.Trash size={16} />}
                                                                    onClick={() => deleteUser(user.id)}
                                                                    className="p-2"
                                                                />
                                                            )}
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </Card>
                    </div>

                    <Modal
                        isOpen={showUserManagement}
                        onClose={() => {
                            setShowUserManagement(false);
                            setEditingUser(null);
                        }}
                        title={editingUser ? 'Editar Usuario' : 'Agregar Usuario'}
                    >
                        <form onSubmit={addUser} className="space-y-4">
                            <Input
                                label="Nombre Completo"
                                type="text"
                                value={newUser.name}
                                onChange={(e) => setNewUser({ ...newUser, name: e.target.value })}
                                required
                            />
                            <Input
                                label="Usuario"
                                type="text"
                                value={newUser.username}
                                onChange={(e) => setNewUser({ ...newUser, username: e.target.value })}
                                required
                            />
                            <Input
                                label={editingUser ? 'Contrase√±a (dejar vac√≠o para no cambiar)' : 'Contrase√±a'}
                                type="password"
                                value={newUser.password}
                                onChange={(e) => setNewUser({ ...newUser, password: e.target.value })}
                                required={!editingUser}
                            />
                            <Input
                                label="Rol"
                                type="select"
                                value={newUser.role}
                                onChange={(e) => setNewUser({ ...newUser, role: e.target.value })}
                                required
                            >
                                <option value="admin">Administrador</option>
                                <option value="cashier">Cajero</option>
                            </Input>
                            <p className="text-xs text-gray-500">
                                Administrador: acceso completo | Cajero: solo ventas y reportes
                            </p>
                            <div className="flex gap-3 pt-4">
                                <Button
                                    variant="secondary"
                                    onClick={() => setShowUserManagement(false)}
                                    fullWidth
                                >
                                    Cancelar
                                </Button>
                                <Button type="submit" variant="primary" fullWidth>
                                    {editingUser ? 'Actualizar' : 'Agregar'}
                                </Button>
                            </div>
                        </form>
                    </Modal>

                    <Modal
                        isOpen={showCategoryManagement}
                        onClose={() => {
                            setShowCategoryManagement(false);
                            setEditingCategory(null);
                            setNewCategory('');
                        }}
                        title={editingCategory ? 'Editar Categor√≠a' : 'Agregar Categor√≠a'}
                    >
                        <form onSubmit={addCategory} className="space-y-4">
                            <Input
                                label="Nombre de la Categor√≠a"
                                type="text"
                                value={newCategory}
                                onChange={(e) => setNewCategory(e.target.value)}
                                placeholder="Ej: Ensaladas, Sopas, etc."
                                required
                                autoFocus
                            />
                            <div className="flex gap-3 pt-4">
                                <Button
                                    variant="secondary"
                                    onClick={() => {
                                        setShowCategoryManagement(false);
                                        setEditingCategory(null);
                                        setNewCategory('');
                                    }}
                                    fullWidth
                                >
                                    Cancelar
                                </Button>
                                <Button type="submit" variant="primary" fullWidth>
                                    {editingCategory ? 'Actualizar' : 'Agregar'}
                                </Button>
                            </div>
                        </form>
                    </Modal>
                </div>
            );
        };

        const ThermalReceipt = ({ sale, business }) => {
            return (
                <div className="thermal-receipt border-2 border-gray-200 rounded-lg mb-4">
                    <div className="text-center mb-4">
                        {business.logoType === 'image' ? (
                            <img src={business.logo} alt="Logo" className="mx-auto mb-2 max-h-16" />
                        ) : (
                            <div className="text-4xl mb-2">{business.logo}</div>
                        )}
                        <div className="font-bold text-lg">{business.name}</div>
                        <div className="text-sm">{Formatters.datetime(new Date(sale.date))}</div>
                        <div className="text-sm font-semibold mt-1">Cajero: {sale.cashier}</div>
                    </div>

                    <div className="border-t-2 border-dashed border-gray-300 my-3"></div>

                    {sale.items.map((item, index) => (
                        <div key={index} className="mb-2">
                            <div className="flex justify-between">
                                <span>{item.name}</span>
                            </div>
                            <div className="flex justify-between text-sm">
                                <span>{item.quantity} x {Formatters.currency(item.price)}</span>
                                <span className="font-bold">{Formatters.currency(item.quantity * item.price)}</span>
                            </div>
                        </div>
                    ))}

                    <div className="border-t-2 border-dashed border-gray-300 my-3"></div>

                    <div className="flex justify-between font-bold text-lg mb-2">
                        <span>TOTAL:</span>
                        <span>{Formatters.currency(sale.total)}</span>
                    </div>

                    <div className="text-sm space-y-1">
                        <div className="flex justify-between">
                            <span>M√©todo de Pago:</span>
                            <span className="font-semibold">
                                {sale.paymentMethod === 'cash' ? 'Efectivo' :
                                 sale.paymentMethod === 'transfer' ? 'Transferencia' :
                                 'Mixto'}
                            </span>
                        </div>
                        {sale.cashAmount > 0 && (
                            <div className="flex justify-between">
                                <span>Efectivo:</span>
                                <span>{Formatters.currency(sale.cashAmount)}</span>
                            </div>
                        )}
                        {sale.transferAmount > 0 && (
                            <div className="flex justify-between">
                                <span>Transferencia:</span>
                                <span>{Formatters.currency(sale.transferAmount)}</span>
                            </div>
                        )}
                        {sale.change > 0 && (
                            <div className="flex justify-between font-semibold">
                                <span>Cambio:</span>
                                <span>{Formatters.currency(sale.change)}</span>
                            </div>
                        )}
                    </div>

                    <div className="border-t-2 border-dashed border-gray-300 my-3"></div>
                    <div className="text-center text-sm">
                        ¬°Gracias por su compra!
                    </div>
                </div>
            );
        };

        // ============================================================================
        // APLICACI√ìN PRINCIPAL
        // ============================================================================
        const RestaurantApp = () => {
            const [products, setProducts] = useLocalStorage(CONFIG.STORAGE_KEYS.PRODUCTS, []);
            const [sales, setSales] = useLocalStorage(CONFIG.STORAGE_KEYS.SALES, []);
            const [categories, setCategories] = useLocalStorage(CONFIG.STORAGE_KEYS.CATEGORIES, CONFIG.DEFAULT_CATEGORIES);
            const [users, setUsers] = useLocalStorage(CONFIG.STORAGE_KEYS.USERS, [CONFIG.DEFAULT_USER, CONFIG.DEFAULT_CASHIER]);
            const [businessName, setBusinessName] = useLocalStorage(CONFIG.STORAGE_KEYS.BUSINESS_NAME, CONFIG.DEFAULT_BUSINESS.name);
            const [businessLogo, setBusinessLogo] = useLocalStorage(CONFIG.STORAGE_KEYS.BUSINESS_LOGO, CONFIG.DEFAULT_BUSINESS.logo);
            const [logoType, setLogoType] = useLocalStorage(CONFIG.STORAGE_KEYS.LOGO_TYPE, CONFIG.DEFAULT_BUSINESS.logoType);
            
            const [currentUser, setCurrentUser] = React.useState(null);
            const [isLoggedIn, setIsLoggedIn] = React.useState(false);
            const [currentView, setCurrentView] = React.useState('login');
            
            const [cart, setCart] = React.useState([]);
            const [showPaymentModal, setShowPaymentModal] = React.useState(false);
            const [showReceipt, setShowReceipt] = React.useState(false);
            const [lastSale, setLastSale] = React.useState(null);

            const addToCart = (product) => {
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    if (existingItem.quantity < product.stock) {
                        setCart(cart.map(item =>
                            item.id === product.id
                                ? { ...item, quantity: item.quantity + 1 }
                                : item
                        ));
                    } else {
                        alert('No hay suficiente stock');
                    }
                } else {
                    if (product.stock > 0) {
                        setCart([...cart, { ...product, quantity: 1 }]);
                    } else {
                        alert('Producto sin stock');
                    }
                }
            };

            const removeFromCart = (id) => {
                setCart(cart.filter(item => item.id !== id));
            };

            const updateQuantity = (id, change) => {
                setCart(cart.map(item => {
                    if (item.id === id) {
                        const newQuantity = item.quantity + change;
                        if (newQuantity > 0 && newQuantity <= item.stock) {
                            return { ...item, quantity: newQuantity };
                        }
                    }
                    return item;
                }));
            };

            const getTotal = React.useCallback(() => {
                return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
            }, [cart]);

            const handleLogin = (username, password) => {
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    setIsLoggedIn(true);
                    setCurrentUser(user);
                    setCurrentView('sales');
                } else {
                    alert('Usuario o contrase√±a incorrectos');
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setCurrentUser(null);
                setCurrentView('login');
                setCart([]);
            };

            const processSale = (paymentData) => {
                const sale = {
                    id: Date.now(),
                    ...paymentData,
                    date: new Date().toISOString(),
                    time: Formatters.time(new Date()),
                    cashier: currentUser?.name || 'Cajero'
                };

                paymentData.items.forEach(item => {
                    setProducts(products.map(p =>
                        p.id === item.id
                            ? { ...p, stock: p.stock - item.quantity }
                            : p
                    ));
                });

                setSales([...sales, sale]);
                setLastSale(sale);
                setCart([]);
                setShowReceipt(true);
            };

            const exportData = () => {
                const data = {
                    products,
                    sales,
                    businessName,
                    businessLogo,
                    logoType,
                    categories,
                    users,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `restaurantpos_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (window.confirm('¬øEst√°s seguro de importar estos datos? Se sobrescribir√° la informaci√≥n actual.')) {
                                setProducts(data.products || []);
                                setSales(data.sales || []);
                                setBusinessName(data.businessName || CONFIG.DEFAULT_BUSINESS.name);
                                setBusinessLogo(data.businessLogo || CONFIG.DEFAULT_BUSINESS.logo);
                                setLogoType(data.logoType || CONFIG.DEFAULT_BUSINESS.logoType);
                                if (data.categories) setCategories(data.categories);
                                if (data.users) setUsers(data.users);
                                alert('Datos importados exitosamente');
                            }
                        } catch (error) {
                            alert('Error al importar los datos. Verifica que el archivo sea v√°lido.');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            React.useEffect(() => {
                if (showReceipt && lastSale) {
                    setTimeout(() => window.print(), 100);
                }
            }, [showReceipt, lastSale]);

            const contextValue = {
                products, setProducts,
                sales, setSales,
                categories, setCategories,
                users, setUsers,
                businessName, setBusinessName,
                businessLogo, setBusinessLogo,
                logoType, setLogoType,
                currentUser,
                cart, setCart,
                addToCart,
                removeFromCart,
                updateQuantity,
                getTotal,
                setShowPaymentModal,
                exportData,
                importData
            };

            if (!isLoggedIn) {
                return <Login onLogin={handleLogin} />;
            }

            return (
                <AppContext.Provider value={contextValue}>
                    <div className="min-h-screen bg-gray-50">
                        <Header user={currentUser} onLogout={handleLogout} />
                        
                        <Navigation 
                            currentView={currentView} 
                            onViewChange={setCurrentView} 
                        />

                        <main className="main-container container mx-auto px-3 sm:px-6 py-4 sm:py-6">
                            {currentView === 'sales' && <SalesModule />}
                            {currentView === 'reports' && <ReportsModule />}
                            {currentView === 'inventory' && currentUser?.role === 'admin' && <InventoryModule />}
                            {currentView === 'settings' && currentUser?.role === 'admin' && <SettingsModule />}
                        </main>

                        <PaymentModal
                            isOpen={showPaymentModal}
                            onClose={() => {
                                setShowPaymentModal(false);
                                setCart([]);
                            }}
                            onConfirm={processSale}
                        />

                        {showReceipt && lastSale && (
                            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md modal-content">
                                    <div className="p-4 sm:p-6 no-print">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-bold">Venta Completada</h3>
                                            <button
                                                onClick={() => setShowReceipt(false)}
                                                className="touch-target p-2 hover:bg-gray-100 rounded-lg"
                                            >
                                                <Icons.X size={24} />
                                            </button>
                                        </div>

                                        <ThermalReceipt 
                                            sale={lastSale} 
                                            business={{ name: businessName, logo: businessLogo, logoType }}
                                        />

                                        <div className="flex gap-3">
                                            <Button
                                                variant="info"
                                                icon={<Icons.Printer size={20} />}
                                                onClick={() => window.print()}
                                                fullWidth
                                            >
                                                Imprimir
                                            </Button>
                                            <Button
                                                variant="secondary"
                                                onClick={() => setShowReceipt(false)}
                                                fullWidth
                                            >
                                                Cerrar
                                            </Button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </AppContext.Provider>
            );
        };

        ReactDOM.render(<RestaurantApp />, document.getElementById('root'));
    </script>
</body>
</html>